<!--
File: search.html
Standalone search page (similar to quick-search but full page).
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TrueSocial ‚Äî Search</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--orange:#ff7a00;--muted:#6b6b6b}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:#f3f3f3}
    .app{max-width:420px;margin:18px auto;background:#fff;border-radius:16px;overflow:hidden;border:1px solid rgba(0,0,0,.04)}
    .header{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid rgba(0,0,0,.04);background:#fff}
    .dot{width:44px;height:44px;border-radius:10px;background:var(--orange);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    .container{padding:14px}
    .input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,.06)}
    .result{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.03);margin-top:10px}
    .pfp{width:56px;height:56px;border-radius:12px;object-fit:cover}
    .btn{padding:8px 10px;border-radius:10px;border:0;background:var(--orange);color:#fff;cursor:pointer}
    .small{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="dot">TS</div>
      <div>
        <div style="font-weight:800">TrueSocial</div>
        <div class="small">Search</div>
      </div>
      <button style="margin-left:auto;border:0;background:transparent;cursor:pointer" onclick="location.href='index.html'">üè†</button>
    </div>

    <div class="container">
      <input id="q" class="input" placeholder="Search by name or username" />
      <div id="results"></div>
    </div>

    <div style="padding:12px;border-top:1px solid rgba(0,0,0,.04);display:flex;justify-content:space-around">
      <div onclick="location.href='index.html'" class="small">üí¨ Chats</div>
      <div class="small" style="color:var(--orange)">üîé Search</div>
      <div onclick="location.href='profile.html'" class="small">üë§ Profile</div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCK4lJ_mjj5GNAruuIMxeiQprdB_vvcEP8",
      authDomain: "truesocial-94e80.firebaseapp.com",
      projectId: "truesocial-94e80",
      storageBucket: "truesocial-94e80.firebasestorage.app",
      messagingSenderId: "993255311929",
      appId: "1:993255311929:web:539d116fda9911960d5be8",
      measurementId: "G-Y2YQ6DJJGS"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const qInp = document.getElementById('q');
    const results = document.getElementById('results');

    auth.onAuthStateChanged(user=>{
      if(!user) location.href='login.html';
    });

    qInp.addEventListener('input', async ()=>{
      const q = qInp.value.trim().toLowerCase();
      results.innerHTML = '';
      if(!q) return;
      // fetch a small sample and filter client-side (v1)
      const snap = await db.collection('users').limit(100).get();
      const arr = snap.docs.map(d=>d.data()).filter(u => (u.name||'').toLowerCase().includes(q) || (u.username||'').toLowerCase().includes(q));
      if(!arr.length) { results.innerHTML = '<div class="small">No results</div>'; return; }
      arr.forEach(u=>{
        const node = document.createElement('div');
        node.className = 'result';
        node.innerHTML = `<img class="pfp" src="${u.pfp||'https://picsum.photos/seed/'+u.uid+'/80'}" />
          <div style="flex:1">
            <div style="font-weight:800">${u.name}</div>
            <div class="small">@${u.username||''}</div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px">
            <button class="btn" data-uid="${u.uid}">View</button>
            <button class="btn secondary" data-req="${u.uid}" style="background:transparent;color:var(--orange);border:1px solid rgba(255,122,0,.12)">Request</button>
          </div>`;
        // view opens quick small profile
        node.querySelector('[data-uid]')?.addEventListener('click', ()=> openQuick(u));
        node.querySelector('[data-req]')?.addEventListener('click', async ()=>{
          const me = auth.currentUser; if(!me) return alert('Login required');
          await db.collection('friendRequests').add({ from: me.uid, to: u.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
          alert('Friend request sent');
        });
        results.appendChild(node);
      });
    });

    function openQuick(u){
      const w = window.open('', 'profileQuick', 'width=380,height=360');
      w.document.body.innerHTML = `<div style="font-family:Inter,system-ui;padding:12px">
        <h3>${u.name}</h3><div class="small">@${u.username||''}</div>
        <img src="${u.pfp||'https://picsum.photos/seed/'+u.uid+'/120'}" style="width:120px;height:120px;border-radius:12px;display:block;margin-top:12px"/>
        <p style="margin-top:8px">${u.bio||''}</p>
        <button id="req" style="padding:10px;background:${getComputedStyle(document.documentElement).getPropertyValue('--orange')||'#ff7a00'};color:#fff;border:0;border-radius:8px;cursor:pointer">Send Request</button>
      </div>`;
      w.document.getElementById('req').addEventListener('click', async ()=>{
        const me = auth.currentUser;
        if(!me){ alert('Login required'); w.close(); return; }
        await db.collection('friendRequests').add({ from: me.uid, to: u.uid, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        alert('Request sent'); w.close();
      });
    }
  </script>
</body>
</html>
