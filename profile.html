<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TrueSocial ‚Äî Profile</title>

<style>
  :root {
    --orange: #ff7a00;
    --white: #fff;
    --bg: #fafafa;
    --muted: #777;
  }

  * { box-sizing: border-box; }
  body {
    font-family: "Inter", system-ui, sans-serif;
    background: var(--bg);
    margin: 0;
    color: #222;
  }

  .app {
    max-width: 480px;
    margin: auto;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    background: var(--white);
  }

  /* Header */
  header {
    background: var(--orange);
    color: #fff;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  header .logo { font-weight: 700; font-size: 18px; }
  header button {
    background: transparent;
    border: none;
    color: #fff;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
  }

  /* Profile area */
  .profile-card {
    text-align: center;
    padding: 20px 16px;
  }
  .pfp {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--orange);
  }
  .change-pfp {
    display: inline-block;
    background: var(--orange);
    color: #fff;
    border: none;
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 13px;
    margin-top: 8px;
    cursor: pointer;
  }
  .name {
    margin-top: 10px;
    font-weight: 700;
    font-size: 20px;
  }
  .username {
    color: var(--muted);
    font-size: 14px;
  }

  /* Info fields */
  .info-section {
    padding: 0 16px 90px;
  }
  .field {
    margin-top: 16px;
  }
  .field label {
    display: block;
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .field div {
    padding: 10px 12px;
    background: #f8f8f8;
    border-radius: 10px;
    font-size: 15px;
  }
  .field[contenteditable="true"], .field div[contenteditable="true"] {
    background: #fff;
    border: 1px solid var(--orange);
  }

  /* Floating save bar */
  .save-bar {
    position: fixed;
    bottom: 56px;
    left: 0;
    right: 0;
    background: var(--white);
    border-top: 1px solid rgba(0,0,0,0.08);
    padding: 10px 16px;
    max-width: 480px;
    margin: auto;
    display: none;
    justify-content: space-between;
    align-items: center;
  }

  .btn {
    border: none;
    border-radius: 10px;
    padding: 10px 16px;
    font-weight: 600;
    cursor: pointer;
  }
  .btn.orange { background: var(--orange); color: #fff; }
  .btn.outline { border: 1px solid var(--orange); color: var(--orange); background: transparent; }

  /* Bottom navigation */
  nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 56px;
    background: #fff;
    border-top: 1px solid rgba(0,0,0,0.08);
    display: flex;
    justify-content: space-around;
    align-items: center;
    max-width: 480px;
    margin: auto;
  }
  nav button {
    background: transparent;
    border: none;
    color: var(--muted);
    font-size: 22px;
    cursor: pointer;
  }
  nav button.active { color: var(--orange); }

  @media (hover:hover) {
    .btn:hover { opacity: 0.85; }
    nav button:hover { color: var(--orange); }
  }
</style>
</head>

<body>
<div class="app">
  <header>
    <div class="logo">TrueSocial</div>
    <button id="editBtn">Edit</button>
  </header>

  <div class="profile-card">
    <img id="pfpImg" class="pfp" src="https://picsum.photos/seed/me/200" alt="pfp" />
    <input type="file" id="fileInput" accept="image/*" hidden />
    <button class="change-pfp" id="changePfp">Change Photo</button>
    <div class="name" id="displayName">Your Name</div>
    <div class="username" id="displayUsername">@username</div>
  </div>

  <div class="info-section">
    <div class="field">
      <label>Bio</label>
      <div id="bio" contenteditable="false">Tap Edit to add a bio.</div>
    </div>

    <div class="field">
      <label>Name</label>
      <div id="name" contenteditable="false">Your Name</div>
    </div>

    <div class="field">
      <label>Username</label>
      <div id="username" contenteditable="false">yourusername</div>
    </div>
  </div>

  <div class="save-bar" id="saveBar">
    <button class="btn outline" id="logoutBtn">Logout</button>
    <button class="btn orange" id="saveBtn">Save Changes</button>
  </div>

  <nav>
    <button onclick="location.href='home.html'">üè†</button>
    <button onclick="location.href='search.html'">üîç</button>
    <button onclick="location.href='chat.html'">üí¨</button>
    <button class="active" onclick="location.href='profile.html'">üë§</button>
    <button onclick="location.href='notifications.html'">üîî</button>
  </nav>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCK4lJ_mjj5GNAruuIMxeiQprdB_vvcEP8",
    authDomain: "truesocial-94e80.firebaseapp.com",
    projectId: "truesocial-94e80",
    storageBucket: "truesocial-94e80.appspot.com",
    messagingSenderId: "993255311929",
    appId: "1:993255311929:web:539d116fda9911960d5be8",
    measurementId: "G-Y2YQ6DJJGS"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const editBtn = document.getElementById("editBtn");
  const saveBar = document.getElementById("saveBar");
  const saveBtn = document.getElementById("saveBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const pfpImg = document.getElementById("pfpImg");
  const changePfp = document.getElementById("changePfp");
  const fileInput = document.getElementById("fileInput");
  const nameEl = document.getElementById("name");
  const usernameEl = document.getElementById("username");
  const bioEl = document.getElementById("bio");
  const displayName = document.getElementById("displayName");
  const displayUsername = document.getElementById("displayUsername");

  let meUid = null;
  let editing = false;
  let uploadedPfpUrl = "";

  auth.onAuthStateChanged(async (user) => {
    if (!user) return (location.href = "login.html");
    meUid = user.uid;
    const doc = await db.collection("users").doc(meUid).get();
    if (doc.exists) {
      const d = doc.data();
      pfpImg.src = d.pfp || `https://picsum.photos/seed/${meUid}/200`;
      nameEl.textContent = d.name || "";
      usernameEl.textContent = d.username || "";
      bioEl.textContent = d.bio || "";
      displayName.textContent = d.name || "Your Name";
      displayUsername.textContent = "@" + (d.username || "username");
    }
  });

  editBtn.addEventListener("click", () => {
    editing = !editing;
    [bioEl, nameEl, usernameEl].forEach((el) =>
      el.setAttribute("contenteditable", editing)
    );
    editBtn.textContent = editing ? "Cancel" : "Edit";
    saveBar.style.display = editing ? "flex" : "none";
  });

  changePfp.addEventListener("click", () => {
    if (!editing) return alert("Tap Edit first!");
    fileInput.click();
  });

  fileInput.addEventListener("change", async (e) => {
    const f = e.target.files[0];
    if (!f) return;
    pfpImg.src = URL.createObjectURL(f);
    const ref = storage.ref().child(`pfps/${meUid}_${Date.now()}_${f.name}`);
    await ref.put(f);
    uploadedPfpUrl = await ref.getDownloadURL();
    alert("Picture uploaded! Save to apply.");
  });

  saveBtn.addEventListener("click", async () => {
    const name = nameEl.textContent.trim();
    const username = usernameEl.textContent.trim().replace(/^@/, "");
    const bio = bioEl.textContent.trim();
    const payload = { name, username, bio, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
    if (uploadedPfpUrl) payload.pfp = uploadedPfpUrl;
    await db.collection("users").doc(meUid).set(payload, { merge: true });
    displayName.textContent = name;
    displayUsername.textContent = "@" + username;
    alert("Profile saved!");
    editBtn.click();
  });

  logoutBtn.addEventListener("click", async () => {
    await auth.signOut();
    location.href = "login.html";
  });
</script>
</body>
</html>
